{% extends "insights_base.html" %}

{% block title %}{{selected_year}} Insights - The Blue Alliance{% endblock %}

{% block meta_description %}FIRST Robotics Competition insights from {{selected_year}}.{% endblock %}

{% block detailed_content %}
  <h1 class="end_header">{{selected_year}} Insights</h1>

  <h2>Awards</h2>
    {% if blue_banners %}
    <div class="row-fluid">
      <h3>Top Blue Banner Winners</h3>
      <div class="span8 offset2">
	      <table class="table table-striped table-condensed table-center">
	        <tbody>
	          <tr><th>Number</th><th>Teams</th></tr>
		        {% for number, team_list in blue_banners.data %}
		          {% if number > 1 or blue_banners.data|length == 1 %}
		          <tr>
		            <td>{{number}}</td>
		            <td>
		              {% for team in team_list %}
		              <a href="/team/{{team}}">{{team|digits}}</a>{% if not forloop.last %},{% endif %}
		              {% endfor %}
		            </td>
		          </tr>
		          {% endif %}
	          {% endfor %}
	      </table>
      </div>
    </div>
    {% endif %}
    
    {% if regional_district_winners %}
    <div class="row-fluid">
      <h3>Top Regional & District Winners</h3>
      <div class="span8 offset2">
        <table class="table table-striped table-condensed table-center">
          <tbody>
            <tr><th>Number</th><th>Teams</th></tr>
            {% for number, team_list in regional_district_winners.data %}
              {% if number > 1 or regional_district_winners.data|length == 1 %}
              <tr>
                <td>{{number}}</td>
                <td>
                  {% for team in team_list %}
                  <a href="/team/{{team}}">{{team|digits}}</a>{% if not forloop.last %},{% endif %}
                  {% endfor %}
                </td>
              </tr>
              {% endif %}
            {% endfor %}
        </table>
      </div>
    </div>
    {% endif %}
  
  <hr>
  <h2>Matches</h2>
    {% if match_highscore %}
    <div class="row-fluid">
      <h3>Highest Scoring Match{% if match_highscore.data.0|length > 1 %}es{% endif %}</h3>
      <div class="span8 offset2">
	      {% for match in  match_highscore.data.0 %}
	      <h4><a href="/match/{{match.key_name}}">{{ match.event_name }} <small>{{ match.verbose_name }}</small></a></h4>
        <table class="matchTable">
          <tr class="key">
            <th colspan="{{match.alliances.items.0.1.teams|length}}">Teams</th>
            <th>Score</th>
          </tr>
          {% for items in match.alliances.items reversed %}
          <tr>
             {% for team in items.1.teams %}
               <td class="{{ items.0 }}{% ifequal match.winning_alliance items.0 %} winner{% endifequal %}"><a href="/team/{{ team|slice:"3:" }}">{{ team|slice:"3:" }}</a></td>
             {% endfor %}
             <td class="{{items.0}}Score{% ifequal match.winning_alliance items.0 %} winner{% endifequal %}">{% ifequal items.1.score "-1" %}?{% else %}{{ items.1.score }}{% endifequal %}</td>
          </tr>
          {% endfor %}
        </table>
	      {% endfor %}
		  </div>
		</div>
		
    <div class="row-fluid">
      <h3>Highest Scoring Matches By Week</h3>
      <div class="span8 offset2">
      {% for week, matches in match_highscore.data.1 %}
        <h3>{{week}}</h3>
        {% for match in matches %}
        <h4><a href="/match/{{match.key_name}}">{{ match.event_name }} <small>{{ match.verbose_name }}</small></a></h4>
        <table class="matchTable">
          <tr class="key">
            <th colspan="{{match.alliances.items.0.1.teams|length}}">Teams</th>
            <th>Score</th>
          </tr>
          {% for items in match.alliances.items reversed %}
          <tr>
             {% for team in items.1.teams %}
               <td class="{{ items.0 }}{% ifequal match.winning_alliance items.0 %} winner{% endifequal %}"><a href="/team/{{ team|slice:"3:" }}">{{ team|slice:"3:" }}</a></td>
             {% endfor %}
             <td class="{{items.0}}Score{% ifequal match.winning_alliance items.0 %} winner{% endifequal %}">{% ifequal items.1.score "-1" %}?{% else %}{{ items.1.score }}{% endifequal %}</td>
          </tr>
          {% endfor %}
        </table>
        {% endfor %}
      {% endfor %}
      </div>
    </div>
    {% endif %}

    {% if match_averages %}
    <h3>Average Match Score By Week</h3>
      <figure style="width: 90%; height: 300px;" id="match-average-chart"></figure>
      <div id="match-average" class="xcharts-data xcharts-line-data-2">{{ match_averages.data_json }}</div>
    {% endif %}
    
    {% if bucketed_scores %}
    <h3>Match Score Distribution <small>Percent of Matches vs. Match Score</small></h3>
      <figure style="width: 90%; height: 300px;" id="match-distribution-chart"></figure>
      <div id="match-distribution" class="xcharts-data xcharts-line-data-1">{{ bucketed_scores.data_json }}</div>
    {% endif %}

  <!-- 
  {% if blue_banners %}  
  <div class="insights_block">
    <div class="insights_content">
      <h4>Top Blue Banner Winners</h4>
      {% for num_wins, team_list in blue_banners %}
        {% if num_wins > 1 %}
          <p>{{num_wins}}, {{team_list}}</p>
        {% endif %}
      {% endfor %}
    </div>
  </div>
  {% endif %}
   -->
<!-- 
  <div class="insights_block">
    <div class="insights_content insights_content_half">
      <h4>Chairman's Award Winner</h4>
      <p>{{ ca_winner|slice:'3:' }}</p>
    </div>

    <div class="insights_content insights_content_half insights_content_last">
      <h4>Chairman's Award Winner</h4>
      <p>{{ ca_winner|slice:'3:' }}</p>
    </div>
  </div>
  
  <div class="insights_block">
    <div class="insights_content insights_content_third">
      <h4>Chairman's Award Winner</h4>
      <p>{{ ca_winner|slice:'3:' }}</p>
    </div>

    <div class="insights_content insights_content_third">
      <h4>Chairman's Award Winner</h4>
      <p>{{ ca_winner|slice:'3:' }}</p>
    </div>

    <div class="insights_content insights_content_third insights_content_last">
      <h4>Chairman's Award Winner</h4>
      <p>{{ ca_winner|slice:'3:' }}</p>
    </div>
  </div>
  
  <div class="insights_block">
    <div class="insights_content">
      <h4>Top Blue Banner Winners</h4>
      {% for num_wins, team_list in blue_banners %}
        {% if num_wins > 1 %}
          <p>{{num_wins}}, {{team_list}}</p>
        {% endif %}
      {% endfor %}
    </div>
  </div>
  
  <div class="insights_block">
    <div class="insights_content">
      <h4>Top Regional/District Winners</h4>
      {% for num_wins, team_list in regional_winners %}
        {% if num_wins > 1 %}
          <p>{{num_wins}}, {{team_list}}</p>
        {% endif %}
      {% endfor %}
    </div>
  </div>
  
  <div class="insights_block">
    <div class="insights_content insights_content_half">
      <h4>Highest Scoring Match</h4>
      <p>--</p>
    </div>
  </div>
  -->
   
  <!-- 
  <div class="row-fluid">
    <div class="span4 well">
      <h4>Chairman's Award Winner</h4>
      <p>{{ ca_winner|slice:'3:' }}</p>
    </div>
  
    <div class="span4 well">
      <h4>Top Blue Banner Winners</h4>
      {% for num_wins, team_list in blue_banners %}
        {% if num_wins > 1 %}
          <p>{{num_wins}}, {{team_list}}</p>
        {% endif %}
      {% endfor %}
    </div>
  
    <div class="span4 well">
      <h4>Top Regional/District Winners</h4>
      {% for num_wins, team_list in regional_winners %}
        {% if num_wins > 1 %}
          <p>{{num_wins}}, {{team_list}}</p>
        {% endif %}
      {% endfor %}
    </div>
  </div>
  -->

  <!-- 
  <h2>Division Winners</h2>
  {{ division_winners }}
  
  <h2>Division Finalists</h2>
  {{ division_finalists }}
  
  <h2>World Champions</h2>
  {{ world_champions }}
  
  <h2>World Finalists</h2>
  {{ world_finalists }}
  
  <h2>RCA Winners</h2>
  {{ rca_winners }}
  
  <h2>CA Winner</h2>
  {{ ca_winner }}
  
  <h2>Blue Banners</h2>
  {% for num_wins, team_list in blue_banners %}
    {% if num_wins > 1 %}
      <p>{{num_wins}}, {{team_list}}</p>
    {% endif %}
  {% endfor %}
   -->
{% endblock %}
